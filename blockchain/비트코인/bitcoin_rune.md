# 비트코인 룬



2024년 4월 19일, 비트코인의 반감기 이벤트가 진행되는 블록 높이 840,000에서 비트코인 룬 프로토콜이 활성화가 되었다. 비트코인 룬(Bitcoin Runes)이란 비트코인 블록체인에서 대체 가능한 토큰을 생성할 수 있게 하는 프로토콜이다. 비트코인에서는 이더리움과 같이 새로운 토큰을 발급하는 것이 불가능하다고 알고 있었기에, 어떻게 비트코인 네트워크에서 이러한 것이 가능하게 되었는지 정리해보고자 한다.



## 비트코인 개요



비트코인은 태생부터 목적과 한계가 뚜렷한 네트워크이다. 비트코인은 화폐 시스템을 지향하기 때문에, 비트코인의 언어인 Bitcoin script는 의도적으로 제한되어 있고 이더리움과 다르게 튜링 완전 (Turing-complete)하지 않다. Bitcoin script는 간결함과 보안성을 위해 만들어졌기 때문에 동작의 복잡성은 제한되어 있다.



그렇다고 비트코인 네트워크에서 코인의 교환만 가능한 것은 아니다. `Witness Data`와 `OP_RETURN`과 같이 거래 이력 외의 정보를 기록할 수 있기 때문에, 이를 통해서 별도의 스크립트를 실행하는 것이 가능하다. 우선, 비트코인이 어떻게 동작하는지 살펴보겠다.



### 주요 비트코인 개념

#### UTXO 모델

UTXO(미사용 거래 출력)란 비트코인에서 사용하는 거래의 잔고 추적 방식으로, Unspent Transaction Output의 약자이다. 한 사람이 트랜잭션의 아웃풋으로 받은 비트코인들 중 다른 트랜잭션의 인풋으로 **사용되지 않은 비트코인들이 해당 인의 잔고**임을 의미한다.



#### 트랜잭션

트랜잭션이란, 비트코인 네트워크 내에서 비트코인을 한 주소에서 다른 주소로 전송하는 과정을 말한다. 모든 트랜잭션은 자금으로 사용하는 소스(Input)로 시작해서, 거래 출력(output)으로써 재분배되는 값으로 끝난다. 트랜잭션은 다음과 같은 기본 요소로 구성된다.

- Input

  - 인풋은 송신자가 사용할 비트코인을 들고 있음을 증명하는 이전 트랜잭션 출력들에 대한 참조이다.
  - 인풋은 다음 3가지를 포함한다.
    1. 이전 트랜잭션 해시 : 사용할 UTXO를 포함하는 트랜잭션의 ID
    2. Output Index : 이전 트랜잭션에서의 UTXO 위치
    3. ScriptSig : 서명값을 제공하는 스크립트

- Output

  - 아웃풋은 얼마나 많은 비트코인이 보내졌고, 어떤 위치들로 분배되었는지 명시한다.

  - 아웃풋은 다음 2가지를 포함한다.

    - 값 : 특정 주소로 보내지는 비트코인의 양

    - ScriptPubKey : 출력이 소비될 수 있는 조건을 설정하는 잠금 스크립트

      - 일반적으로 수신자의 공개 키 해시로 구성되며, 이 주소를 사용하여 해당 비트코인을 사용할 수 있는 권한을 설정

        (다음 인풋이 올바른 디지털 서명을 제공해야 함을 요구)

- Witness Data (Optional) 

  - SegWit 트랜잭션의 경우, 서명 및 기타 인증 데이터를 포함한다.
  - 트랜잭션의 다른 부분과 분리되어 저장된다.

- OP_RETURN (Optional)

  - OP_RETURN은 비트코인 스크립트 언어에서 제공하는 연산자로, 트랜잭션에 임의의 데이터를 저장할 수 있게 해준다.
  - 트랜잭션에 80바이트까지의 임의 데이터를 첨부할 수 있다.



#### Segregated Witness

비트코인 프로토콜에 일어난 업데이트로, 블록체인에서 데이터가 저장되고 전송되는 방식에 대한 방식을 바꾸었다. 특히,  트랜잭션 데이터에서 서명을 Witness Data로 분리시켰다. 

해당 업데이트로, 다음 두가지 개선이 일어났다.

**1. 트랜잭션 가변성 문제 해결**

기존 방식으로는 이미 전파된 트랜잭션에 대해서, 서명에 불필요한 0을 추가하거나 제거하는 방식으로 서명만 바꾸어서 재전파가 가능하였다(불필요한 0을 추가하거나 제거하여도 서명은 유효하게 동작). 트랜잭션 데이터가 서명 데이터를 포함하고 있다면, 서명 값이 바뀌면 트랜잭션 해시도 같이 바뀌기 때문에 네트워크에서 같은 트랜잭션임을 인식하지 못 하기 때문에 중복된 트랜잭션을 전파시키는 것이 가능하였다. 하지만, 서명 데이터를 트랜잭션 데이터와 분리함으로써, 서명값이 변경되어도 트랜잭션 해시는 바뀌지 않아 중복 인식이 가능해졌다.

**2. 확장성 개선**

Witness Data(서명 데이터)를 일반 트랜잭션 데이터와 다른 부분에 저장하여, 블록 크기를 효율적으로 사용할 수 있게 되었다. 일반 트랜잭션 데이터의 최대 크기는 1MB이며, Witness Data는 최대 크기는 4MB이다. SegWit 트랜잭션의 최대 크기는 기본 데이터와 Witness Data의 합인 5MB까지 가능하기에, 기존 1MB 트랜잭션에 비해 처리량이 증가하였다. 



#### OP_RETURN

OP_RETURN는 비트코인 스크립트 언어의 동작 코드(operation code)로 데이터가 비트코인 트랜잭션에 새겨지도록 한다. OP_RETURN은 다음 2가지 주요 특징을 가진다.

**1. 임의 데이터 저장**

OP_RETURN는 최대 80 bytes의 임의 데이터를 **트랜잭션 내**에 저장할 수 있도록 해준다. 주로, 디지털 자산 발행, 시간 증빙 문서, 메시지 작성 등에 사용된다.

**2. 사용 불가능한 출력(output)**

OP_RETURN과 함께 출력된 output은 더 이상 사용 가능한 UTXO 세트에 들어가지 않으며, 재사용이 불가능하다. OP_RETURN 출력은 비트코인을 전송하거나 소비하는 출력이 아니라, 데이터를 블록체인에 저장하기 위한 출력이다.  `OP_RETURN`은 네트워크에 "이 **출력은 가치를 전송하는 데 사용할 수 없다**"라고 알림으로써, 출력이 트랜잭션의 일부로 존재하지만 UTXO 세트에 포함되지 않게 한다.





##  한계 극복 시도



비트코인에서는 임의 데이터를 저장하는데 그 용도와 용량이 제한되어 있기 때문에, 비트코인 거래 외에는 한계가 존재한다. 특히, 완전 튜링 언어인 이더리움에서는 ERC-20(DT), ERC-721(NFT), ERC-1400(ST) 등 다양한 토큰을 끊임없이 생성하고 시도할 수 있었던 것과는 다르게 비트코인에서는 토큰 기반 기능에 있어서 한계가 존재했다. 하지만 그렇다고 비트코인에서도 그런 시도들이 없었던 것이 아니라, 다음과 같이 비트코인 스크립트의 한계를 극복하고 토큰화 시키는 시도들이 존재했다. 



### Ordinals

`Ordinals`는 비트코인 사토시(비트코인 최소 단위)에 넘버링을 붙여서, 특정 사토시들을 다른 사토시들과 구별되게 해준다. 사토시는 비트코인은 채굴된 순서대로 번호가 매겨져, 번호에 따라 등급(카테고리)로 나누어지게 된다. `Ordinals`는 개별 사토시들을 추적하고 송신 가능하게 하여, 사토시들을 fungible token 혹은 non fungible token로 활용할 수 있게 한다.



넘버링에 따른 사토시 등급은 다음과 같이 나눌 수 있다.

| 등급      | 설명                                                         |
| --------- | ------------------------------------------------------------ |
| Common    | 블록에서 첫 번째 사토시를 제외한 모든 사토시                 |
| Uncommon  | 각각의 블록에서의 첫 번째 사토시                             |
| Rare      | 매 채굴 난이도 조정 이후 첫 번째 사토시                      |
| Epic      | 매 반감기 이벤트 이후 첫 번째 사토시                         |
| Legendary | 매 비트코인 cycle(난이도 조정과 반감기가 만나는 주기) 이후 첫 번째 사토시 |
| Mythic    | 제네시스 블록에서의 첫 번째 사토시                           |
| Ancient   | 78번 블록까지의 사토시                                       |
| Named     | 각각의 사토시들은 랜덤한 문자로 명명되는데, 이때 rare한 이름을 가진 경우 |



### Inscription

`Inscription`은 사토시에 특정 script을 새기는(insribe) 것을 의미한다. script는 이미지, 텍스트, HTML 등을 포함할 수 있어, 각각의 사토시들이 NFT와 같이 유일한 정보를 가질 수 있도록 한다. 이러한 script는 트랜잭션 출력의 `OP_RETURN` 이나 `Witness` 데이터 필드에 저장되어 진다.

다만, Inscription한 사토시를 전송하기 위해서는 총 두번의 트랜잭션이 필요하다. 첫 번째 트랜잭션에서는 특정 사토시와 script를 연결시키는 작업을 수행하며, 두 번째 트랜잭션에서 실제로 해당 사토시를 전송시킨다. (단, 이미 Inscription된 사토시를 단순히 전송시킬 때에는 평소와 같이 한번의 트랜잭션만 수행된다.)



### BRC-20

BRC-20은 Inscription을 이용하여, 개별 사토시들을 fungible token으로 만드는 시도이다. BRC-20은 Witness Data에 토큰에 대한 정보를 작성하고, 해당 정보를 개별 사토시에 새김으로써 토큰에 대한 정보를 네트워크에 기록한다. 

BRC-20은 다음과 같은 순서로 동작한다.

**1.토큰 배포**

배포하고자 하는 토큰의 정보(이름, 최대 발행량, 1회 발행 가능량 등)를 기입한다.

**2. 토큰 발행**
토큰의 이름과 발행량을 기입한다.

**3. 토큰 전송**

토큰 이름과 전송하고자 하는 수량을 기입한다. 단, 이때는 실제 전송이 일어나는 것이 아닌, 전송하고자 하는 트랜잭션의 정보만 기입된다.

**4. 사토시 전송**

전송 정보를 기입한 사토시를 실제 수신자한테 송신함으로써 BRC-20 토큰을 전송한다.



BRC-20은 비트코인 네트워크에서 이더리움의 ERC-20처럼 토큰을 생성할 수 있게 하였지만, 트랜잭션이 여러 번 수행되어야 하는 비효율을 가지고 있다. 위의 1~4의 과정은 각각 별도의 트랜잭션































