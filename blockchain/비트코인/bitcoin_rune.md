# 비트코인 룬



2024년 4월 19일, 비트코인의 반감기 이벤트가 진행되는 블록 높이 840,000에서 비트코인 룬 프로토콜이 활성화가 되었다. 비트코인 룬(Bitcoin Runes)이란 비트코인 블록체인에서 대체 가능한 토큰을 생성할 수 있게 하는 프로토콜이다. 비트코인에서는 이더리움과 같이 새로운 토큰을 발급하는 것이 불가능하다고 알고 있었기에, 어떻게 비트코인 네트워크에서 이러한 것이 가능하게 되었는지 정리해보고자 한다.



## 비트코인 개요



비트코인은 태생부터 목적과 한계가 뚜렷한 네트워크이다. 비트코인은 화폐 시스템을 지향하기 때문에, 비트코인의 언어인 Bitcoin script는 의도적으로 제한되어 있고 이더리움과 다르게 튜링 완전 (Turing-complete)하지 않다. Bitcoin script는 간결함과 보안성을 위해 만들어졌기 때문에 동작의 복잡성은 제한되어 있다.



그렇다고 비트코인 네트워크에서 코인의 교환만 가능한 것은 아니다. `Witness Data`와 `OP_RETURN`과 같이 거래 이력 외의 정보를 기록할 수 있기 때문에, 이를 통해서 별도의 스크립트를 실행하는 것이 가능하다. 우선, 비트코인이 어떻게 동작하는지 살펴보겠다.



### 주요 비트코인 동작 요소

#### UTXO 모델

UTXO(미사용 거래 출력)란 비트코인에서 사용하는 거래의 잔고 추적 방식으로, Unspent Transaction Output의 약자이다. 한 사람이 트랜잭션의 아웃풋으로 받은 비트코인들 중 다른 트랜잭션의 인풋으로 **사용되지 않은 비트코인들이 해당 인의 잔고**임을 의미한다.



#### 트랜잭션

트랜잭션이란, 비트코인 네트워크 내에서 비트코인을 한 주소에서 다른 주소로 전송하는 과정을 말한다. 모든 트랜잭션은 자금으로 사용하는 소스(Input)로 시작해서, 거래 출력(output)으로써 재분배되는 값으로 끝난다. 트랜잭션은 다음과 같은 기본 요소로 구성된다.

- Input

  - 인풋은 송신자가 사용할 비트코인을 들고 있음을 증명하는 이전 트랜잭션 출력들에 대한 참조이다.
  - 인풋은 다음 3가지를 포함한다.
    1. 이전 트랜잭션 해시 : 사용할 UTXO를 포함하는 트랜잭션의 ID
    2. Output Index : 이전 트랜잭션에서의 UTXO 위치
    3. ScriptSig : 서명값을 제공하는 스크립트

- Output

  - 아웃풋은 얼마나 많은 비트코인이 보내졌고, 어떤 위치들로 분배되었는지 명시한다.

  - 아웃풋은 다음 3가지를 포함한다.

    - 값 : 특정 주소로 보내지는 비트코인의 양

    - ScriptPubKey : 출력이 소비될 수 있는 조건을 설정하는 잠금 스크립트

      - 일반적으로 수신자의 공개 키 해시로 구성되며, 이 주소를 사용하여 해당 비트코인을 사용할 수 있는 권한을 설정

        (다음 인풋이 올바른 디지털 서명을 제공해야 함을 요구)

- Witness Data (증명 데이터)

  - SegWit 트랜잭션의 경우, 서명 및 기타 인증 데이터를 포함한다.
  - 트랜잭션의 다른 부분과 분리되어 저장된다.

- OP_RETURN(메타 데이터)

  - OP_RETURN은 비트코인 스크립트 언어에서 제공하는 연산자로, 트랜잭션에 임의의 데이터를 저장할 수 있게 해준다.
  - 트랜잭션에 80바이트까지의 임의 데이터를 첨부할 수 있다.



#### Segregated Witness

비트코인 프로토콜에 일어난 업데이트로, 블록체인에서 데이터가 저장되고 전송되는 방식에 대한 방식을 바꾸었다. 특히,  트랜잭션 데이터에서 서명을 Witness Data로 분리시켰다. 

해당 업데이트로, 다음 두가지 개선이 일어났다.

**1. 트랜잭션 가변성 문제 해결**

기존 방식으로는 이미 전파된 트랜잭션에 대해서, 서명에 불필요한 0을 추가하거나 제거하는 방식으로 서명만 바꾸어서 재전파가 가능하였다(불필요한 0을 추가하거나 제거하여도 서명은 유효하게 동작). 트랜잭션 데이터가 서명 데이터를 포함하고 있다면, 서명 값이 바뀌면 트랜잭션 해시도 같이 바뀌기 때문에 네트워크에서 같은 트랜잭션임을 인식하지 못 하기 때문에 중복된 트랜잭션을 전파시키는 것이 가능하였다. 하지만, 서명 데이터를 트랜잭션 데이터와 분리함으로써, 서명값이 변경되어도 트랜잭션 해시는 바뀌지 않아 중복 인식이 가능해졌다.

**2. 확장성 개선**

Witness Data(서명 데이터)를 일반 트랜잭션 데이터와 다른 부분에 저장하여, 블록 크기를 효율적으로 사용할 수 있게 되었다. 일반 트랜잭션 데이터의 최대 크기는 1MB이며, Witness Data는 최대 크기는 4MB이다. SegWit 트랜잭션의 최대 크기는 기본 데이터와 Witness Data의 합인 5MB까지 가능하기에, 기존 1MB 트랜잭션에 비해 처리량이 증가하였다. 





 























