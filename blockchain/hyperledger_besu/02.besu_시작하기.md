# besu 시작하기 (config.toml, genesis file)



이번 포스트에서는 Hyperledger Besu를 시작하고, 설정하는 법에 대해서 





## Hyperledger Besu 개요



Hyperledger Besu는 메인넷이라고 하는 공개 이더리움 네트워크로의 연결뿐 아니라, 비공개 블록체인 네트워크와 호환가능한 EVM(Ethereum Virtual Machine)을 생성하는 데에 사용될 수 있다.

메인넷에서는 Besu는 실행 클라이언트로써, 트랜잭션을 실행하고 변화를 장부에 기록하게 된다. 메인넷에서의 노드로써의 동작은 이더리움 메인넷의 동기화를 보조하는 full node부터 블록 생성엔 참여하지 않고 단순 데이터만 저장하는 저장소 노드(archive node)까지 가능한다. 

만약 블록체인 인프라를 사용하고 싶지만, 참여하는 노드들에 제한을 두거나 메인넷에는 없는 규제와 표준을 추가해서 사용하고 싶은 경우에는 EVM을 생성해서 사용할 수 있다. 





## Hyperledger Besu 시작하기



### 기본 명령어로 시작하기

besu는 다음 명령어를 통해, 연결하고자 하는 네트워크를 지정하여 실행할 수 있다.

```sh
besu --network=<network> --data-path=<path>/<networkdata-path>
```

`--network` 에서는 연결하고자 하는 네트워크의 이름을 설정한다. `<network>`은 이더리움 메인넷이 될 수도 있고, *Sepolia*, *Goerli*와 같은 이더리움 테스트넷, 아니면 로컬로 설정할 수 있다. 

`--data-path`에서는 해당 네트워크에서 사용할 데이터 저장 경로를 명시한다. 생략할 경우, default 값으로 `database` 폴더에 저장이 된다. 이전과 다른 네트워크에 연결하는 경우에는 데이터 저장 폴더가 달라져야 하므로, `--data-path`를 통해서 신규 네트워크의 데이터 경로를 새로 지정하거나, 기존 `database` 폴더를 삭제해야 한다.



### config.toml 파일 사용하기

`--network`, `--data-path`와 같은 옵션들이 많이 질 경우, command line에서 관리하는 것에 한계점이 있다. 이에, 설정 파일에 옵션과 서브캐맨드들을 저장해서 사용할 수 있다. 설정 파일은 Besu의 초기 파라미터 값을 명시할 수 있으며, 해당 값들을 재사용할 수 있게 한다.



`config.toml`의 예시는 다음과 같이 설정할 수 있다.

```toml
# 블록체인 데이터가 저장될 데이터 경로
data-path = "./besudata"  # 실행 위치를 기준으로 한 상대경로


# 비공개 네트워크에서 enode URL은 노드를 식별하는 데 사용되며 부트 노드가 시작될 때 서로를 발견하는 데 사용된다.
# 이 예에서는 이 네트워크에 대해 세 개의 부팅 노드가 지정되어 있다.
bootnodes = ["enode://001@123:4567", "enode://002@123:4567", "enode://003@123:4567"]

# Peer to Peer 통신에서 노드에 외부에서 액세스하는 데 사용될 수 있는 노출된 호스트를 지정합니다.
# 1.2.3.4는 단순 예시일 뿐, 실제 ip 주소값이 들어감
p2p-host = "1.2.3.4"

p2p-port = 1234

# 이 네트워크가 설정할 수 있는 최대 Peer to Peer 연결 수
max-peers = 42

# HTTP JSON-RPC가 수신 대기하는 호스트를 지정 
# 5.6.7.8은 단순 예시일 뿐, 실제 ip 주소값이 들어감
rpc-http-host = "5.6.7.8"

# HTTP JSON-RPC 수신 대기 포트 (TCP)
rpc-http-port = 5678

# Websocket WS-RPC가 수신 대기하는 호스트를 지정
# 9.10.11.12은 단순 예시일 뿐, 실제 ip 주소값이 들어감
rpc-ws-host = "9.10.11.12"

# Websockets JSON-RPC 수신 대기 포트 (TCP)
rpc-ws-port = 9101

# 사용자 정의 genesis 파일의 경로이다.
genesis-file = "~/genesis.json"

# 이 옵션은 노드가 시작될 때 채굴을 활성화한다. (합의 메커니즘은 genesis 파일에 규정된다.)
miner-enabled = true

# miner-coinbase는 이 블록체인에 대한 채굴 보상이 지불될 계정을 제공한다.
miner-coinbase = "0xfe3b557e8fb62b89f4916b721be55ceb828dbd73"
```

:bulb: `bootnodes`

- Hyperledger Besu 노드가 네트워크에 참여할 때 다른 노드를 발견하기 위해 사용되는 초기 부트스트랩 노드들의 목록을 나타낸다. 
  - 부트스트랩 노드는 네트워크의 초기 구동 단계에서 노드들이 서로를 찾아 연결할 수 있도록 도와주는 역할 수행한다. 

- `bootnodes`에 사용된 값은 enode URL의 목록이다. 

  - `enode`는 Ethereum 네트워크에서 각 노드를 식별하는 고유한 주소 체계로 노드의 고유 식별자와 네트워크 주소가 포함된다.

    - `001`, `002`, `003` : 각 노드의 고유한 식별자입니다.

    - `123:4567` : 노드의 IP 주소와 포트를 나타냅니다.

















