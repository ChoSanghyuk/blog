# [Hyperledge Besu] Clique Private Network에서 지급 트랜잭션 발생시키기



저번에 생성한 Clique network에서 지급 트랜잭션을 발생시켜보겠다. 지급 트랜잭션이란, 하나의 외부 소유 계정(EOA)에서 다른 외부 소유 계정으로 이더를 보내는 트랜잭션이다.



## 사전 준비



js코드로 작성한 트랜잭션 발생 소스를 실행시키기 위해, ubuntu 환경에 nodejs 환경을 세팅한다.

### nvm 설치

```sh
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.35.3/install.sh | bash
```

### nodejs 설치

```sh
# nodejs 설치
nvm install 20.11.0
# Nodesource 설치 : Nodesource에서 Nodejs 패키지를 설치할 것임을 Ubuntu에 알립니다.
curl -sL https://deb.nodesource.com/setup_18.x | sudo -E bash -
# installing the Node.js runtime 
sudo apt-get install -y nodejs
```

### 필요 dependency 설치

```bash
npm install web3@4.5.0
```

`@` 뒤의 버전은 명시하지 않을 경우, 최신 버전으로 설치가 된다. (다만, 버전이 안 맞을 경우, 코드 실행 시 에러가 날 수 도 있다.)



## 스마트 컨트랙 소스 생성

`smart_contract` 폴더 생성



### keys.js 파일 생성

```js
// WARNING: the keys here are demo purposes ONLY. Please use a tool like Orchestrate or EthSigner for production, rather than hard coding private keys

module.exports = {
    besu: {
    member1: {
      name: "member1",
      url: "http://127.0.0.1:{node1port}",
      nodekey: "{node1PublicKey}",
      accountAddress: "{node1Address}",
      accountPrivateKey: "{node1PrivateKey}"
    },
    member2: {
      name: "member2",
      url: "http://127.0.0.1:{node2port}",
      nodekey: "{node2PublicKey}",
      accountAddress: "{node2Address}",
      accountPrivateKey: "{node2PrivateKey}"
    },
    member3: {
      name: "member3",
      url: "http://127.0.0.1:{node3port}",
      nodekey: "{node3PublicKey}",
      accountAddress: "{node3Address}",
      accountPrivateKey: "{node3PrivateKey}"
    }
  },
  accounts: {
    account1 :  {
      address : "0xfe3b557e8fb62b89f4916b721be55ceb828dbd73",
      privateKey : "0x8f2a55949038a9610f50fb23b5883af3b4ecb3c3bb792cbcefbd1542c692be63",
    },
    account2 :  {
      address : "0x627306090abaB3A6e1400e9345bC60c78a8BEf57",
      privateKey : "0xc87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3",
    },
    account3 :  {
      address : "0xf17f52151EbEF6C7334FAD080c5704D77216b732",
      privateKey : "0xae6ae8e5ccbfb04590405997ee2d52d2b330726137b875053c36d94e974d162f",
    }
  }
};

```



### public_tx.js 생성

```js
const { Web3 } = require('web3');
const {  besu, accounts } = require("./keys.js");

// 1. signer 중 1
const host = besu.member1.url;

async function createContract(host) {
  const web3 = new Web3(host);
  // 2. 이더 보내는 계좌
  const account = accounts.account1 

  const txn = {
    chainId: 2018, // 3. genesis 파일에 명시한 chainId
    nonce: await web3.eth.getTransactionCount(account.address), 
    from: account.address,
    to: besu.member1.accountAddress, // 4. 이더를 받는 계좌
    value: "0x10",  // 5. 보내고자 하는 이더의 양 (wei 단위로 표기)
    data: null,
    gasPrice: "0x0",  // 가스 가격
    gas: "0x2CA51"    // 가스 한도
  };

  console.log("create and sign the txn")
  const signedTx = await web3.eth.accounts.signTransaction(txn, account.privateKey);
  console.log("sending the txn")
  const txReceipt = await web3.eth.sendSignedTransaction(signedTx.rawTransaction);
  console.log("tx transactionHash: " + txReceipt.transactionHash);
};

async function main(){
  createContract(host)
}

if (require.main === module) {
  main();
}

module.exports = exports = main

```



[[마스터링 이더리움] 6장. 트랜잭션](https://dev-ote.tistory.com/45)



## 결과

```bash
curl -X POST -H "Content-Type: application/json" -d'{ "query": "{block {account(address: \"6bfe9766821263a677faae51491c90b7731bb8e2\") { balance }} }"}' http://localhost:8547/graphql
```

6bfe9766821263a677faae51491c90b7731bb8e2 : node1의 주소



![image-20240306170900839](./img/tx결과.png)





## 참고자료

- Hypberledger Besu,Transfer funds between accounts in a transaction, https://besu.hyperledger.org/private-networks/tutorials/contracts/transfer-funds
