# [마스터링 이더리움] 4장. 암호학



본 포스트는 서적 *마스터링 이더리움*의 4장 *암호학* 파트를 정리한 포스트입니다. 해당 파트에서 소개되는 수학적 이론 내용은 제외하고, 이더리움에 적용된 개념적인 내용만 정리하였습니다.



이더리움의 핵심적인 기반 기술 중 하나는 암호학이다. 이 장에서는 이더리움에서 사용하는 암호 방식, 즉 개인키와 주소의 형태로 자금의 소유권을 제어하는 데 사용되는 공개키 암호화(Public Key Cryptography, PKC)를 소개한다.



## 키와 주소



이더리움에서의 공개키 암호화에는 개인키와 개인키로 파생되는 공개키와 계정 주소가 사용된다.

우선, 개인키는 계정에 대한 제어권을 제공하는 키로, 비공개로 유지되어야 한다. 개인키는 어떠한 방법으로도 유추될 수 없도록 단순히 무작위로 선택한 숫자로 생성된다. 이때 엔트로피 즉, 무작위성을 확보하는 것이 가장 중요하다. 이를 위해 Keccak-256, SHA-256 같은 256비트 해시 알고리즘이 사용된다. 또한 개인키 생성 프로세스는 오프라인 프로세스로, 이더리움 네트워크와 다른 사람과의 통신을 필요로 하지 않는다.



공개키는 계정을 식별하고 서명을 검증하는 키로, 공개된 값이다. 공개키는 개인키로부터 '단방향으로' 계산되어져 도출되어진다. '단방향'이란, 개인키가 있는 경우 공개키를 계산하기는 쉽지만, 공개키에서 개인키를 계산할 수는 없음을 의미한다. 이를 위해, 타원 곡선 암호화를 통해서 생성된다.



계정 주소는 트랜잭션의 요청을 받는 고유 식별자 값이다. 외부 소유 계정의 주소는 공개키-개인키 쌍의 공개키 부분에서 생성되는데, 이때는 해시 함수를 사용하여 생성된다.  단, 컨트랙트 계정의 경우, 공개키-개인키 쌍으로 나타나지 않으며, 개인키로 뒷받침되지 않는다. (7장 참고)



## 공개키 암호화와 암호화폐



### 공개키 암호화

공개키 암호화는 공개하는 공개키, 절대 공개되어서는 안되는 비밀키를 사용해서 암호화하는 방식이다. 공개키 암호화는 고유한 키를 사용하여 정보를 보호한다. 이 키는 계산하기는 쉽지만 그 역을 계산하기 어렵다는 수학 함수를 바탕으로 한다. 이러한 함수는 역산하기 위한 단축키로 사용할 수 있는 비밀 정보가 없으면 거꾸로 계산하기 어렵기 때문에, 트랩 도어 함수(trapdoor function)라고도 한다.



### 서명과 검증

공개키 암호화는 고유성을 가진 개인키를 이용해서 서명(sign)을 작성하는 행위가 가능하다. 개인키로 한 행위에 대해서 상대방이 검증할 수 있는 과정도 필요하기 때문에, 공개가 가능한 공개키는 누구나 검증(Verify) 할 수 있도록 공개된다.

이더리움에서는 디지털 서명을 통해, 외부 소유 계정의 이더 소유권을 확립한다. 디지털 서명을 통해 자금의 접근과 통제가 이루어지기에 디지털 서명은 개인키의 소유권을 증명하는 역할을 한다. (개인키를 가진 누구나 해당 계정과 해당 계정이 가진 이더를 제어할 수 있다)



### 이더리움 트랜잭션 검증 과정

우선, 이더리움 트랜잭션에서는 트랜잭션 자체의 세부사항이 메시지로 사용된다. 디지털 서명은 암호 수학으로 해당 메시지를 개인키와 결합하여 개인키를 알아야만 만들 수 있는 코드로 생성하는 것이다. 자금을 이동하거나 스마트 컨트랙트와 상호작용하기 위해 트랜잭션을 보낼 때, 해당 주소에 이 서명도 함께 보내야 한다. 

검증 프로세스에서는 그 트랜잭션이 공개키에 대응되는 개인키에 의해 만들어졌음을 확증한다. 다시 말해, 디지털 서명, 트랜잭션 세부 정보, 접근하는 이더리움 주소가 일치하는 확인하여, 트랜잭션이 유효한지 확인할 수 있음을 의미한다.



## 암호화 해시



암호화 해시 함수는 거의 모든 암호학적 시스템에서 광범위하게 사용되고 있으며, 이더리움에서도 시스템 전반에 걸쳐 사용된다. 예를 들어, 공개키를 주소로 변환하거나, 데이터 확인에 도움이 되는 디지털 지문을 만드는 데 사용할 수 있다.



### 개요

해시 함수란, 임의 크기의 데이터를 고정된 크기의 데이터로 매핑하는데 사용할 수 있는 모든 함수를 지칭한다. 해시 함수에 대한 입력은 사전 이미지, 메시지, 입력 데이터라고 하며, 해시 함수의 결과값을 해시라고 한다.



암호 해시 함수는 임의 크기의 데이터를 고정 크기의 비트 열로 매핑하는 **단방향** 해시 함수다. 단방향 특성은 해시값을 알고 있을 때, 입력 데이터를 다시 작성하는 것이 계산적으로 불가능함을 의미한다. 입력 데이터를 추론하는 방법은 무차별 대입 검색을 수행하는 것인데, 검색 공간이 사실상 무한하여 작업을 실제적으로 불가능하게 만든다. 

해시 함수는 다대일 함수로, 동일한 결과에 해시 처리한 두 입력 데이터 집합을 찾는 것을 **해시 충돌**이라고 한다. 해시 함수가 좋을수록 해시 충돌이 덜 발생하는데, 이더리움에서는 사실상 해시 충돌이 불가능하다.



### 주요 속성

암호화 해시 함수의 주요 속성으로는 다음과 같이 있다.

- 결정론 (determinism)
  - 주어진 입력 데이터는 항상 동일한 해시 결과를 생성
- 검증성 (verifiability)
  - 메시지의 해시 계산은 효율적이다 (선형 복잡성)
- 비상관성 (noncorrelation)
  - 메시지에 대한 작은 변화는 해시 출력을 너무 광범위하게 변경해야 해서, 원본 메시지의 해시와 상관 관계가 없다
- 비가역성(irreversibility)
  - 해시로부터 메시지를 계산하는 것은 불가능

- 충돌 방지 (collision protection)
  - 같은 해시 결과를 생성하는 2개의 서로 다른 메시지를 계산하는 것은 불가능

